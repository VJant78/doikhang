<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tr·ªçng T√†i</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      margin-top: 40px;
      background-color: black;
    }
    .team-box {
      border: 2px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      margin: 0 30px;
      width: 35vw;
      text-align: center;
    }
    .red { border-color: #e74c3c; }
    .blue { border-color: #3498db; }
    .buttons {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      margin-top: 10px;
    }
    .buttons button {
    width: 100%;
    aspect-ratio: 1 / 0.4;
    font-size: 30px;
    cursor: pointer;
}
    .teams {
      display: flex;
      justify-content: center;
      gap: 60px;
    }
  </style>
</head>
<body>
  <div class="teams">
    <div class="team-box red">

      <div class="buttons">
        <button style="background-color: red; color: white; font-size: 150px;" onclick="sendVote('red', 1)">+1</button>
        <button style="background-color: red; color: white; font-size: 150px;" onclick="sendVote('red', 2)">+2</button>
      </div>
    </div>
    <div class="team-box blue">
      <div class="buttons">
        <button style="background-color: blue; color: white; font-size: 150px;" onclick="sendVote('blue', 1)">+1</button>
        <button style="background-color: blue; color: white; font-size: 150px;"onclick="sendVote('blue', 2)">+2</button>
      </div>
    </div>
  </div>

  <script>
    let ws = null;
    
    const params = new URLSearchParams(window.location.search);
    const dataIPws = params.get("ws");
    const datarole = params.get("role");
    function connectWS() {


      ws = new WebSocket("ws://" + dataIPws);

      ws.onopen = () => {
        // G·ª≠i ƒë·ªãnh danh
        const identifyMsg = {
          type: "identify",
          role: `Ref${datarole}`,
        };
        ws.send(JSON.stringify(identifyMsg));
       };

      ws.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        switch (msg.type) {
          case "score_result":
            const { red, blue } = msg.data;
            document.getElementById("score-red").textContent = red;
            document.getElementById("score-blue").textContent = blue;
            break;
          case "error":
            alert(msg.data);
            break;
          case "control":
            break;
          default:
            console.log(`  Kh√¥ng x√°c ƒë·ªãnh: ${JSON.stringify(msg)}  `);
        }
      };
      
      ws.onclose = () => {
       console.log(` ‚ùå WebSocket ƒë√£ ƒë√≥ng`);
      };

      ws.onerror = (err) => {
        console.log(` üö® L·ªói WebSocket: ${err.message}`);
      };
    }

    connectWS(); 
    function sendVote(side, point) {
      if (!datarole) {
        alert("Ch∆∞a nh·∫≠p referee ID ho·∫∑c ch∆∞a k·∫øt n·ªëi.");
        return;
      }
      if (!ws || ws.readyState !== 1) {
        alert("Ch∆∞a k·∫øt n·ªëi WebSocket!");
        return;
      }

      const message = {
        type: "vote",
        data: {
          referee_id: datarole,
          side: side,
          point: point,
        },
      };
      ws.send(JSON.stringify(message));
    
    }
  </script>
</body>
</html>
